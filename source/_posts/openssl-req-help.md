---
title: linux openssl req 生成自签名证书
date: 2019-11-13 20:16:19
tags: 
- Command
- 网络
categories:
- 学习笔记
---

### OpenSSL req 生成自签名证书 ###

openssl req 命令的主要功能：
- 生成自签名证书
- 生成证书请求文件
- 查看验证证书请求文件

<!-- more -->

命令列表如下：
```text
openssl req [options] <infile >outfile
where options  are
 -inform arg    input format - DER or PEM
 -outform arg   output format - DER or PEM
 -in arg        input file
 -out arg       output file
 -text          text form of request
 -pubkey        output public key
 -noout         do not output REQ
 -verify        verify signature on REQ
 -modulus       RSA modulus
 -nodes         don't encrypt the output key
 -engine e      use engine e, possibly a hardware device
 -subject       output the request's subject
 -passin        private key password source
 -key file      use the private key contained in file
 -keyform arg   key file format
 -keyout arg    file to send the key to
 -rand file:file:...
                load the file (or the files in the directory) into
                the random number generator
 -newkey rsa:bits generate a new RSA key of 'bits' in size
 -newkey dsa:file generate a new DSA key, parameters taken from CA in 'file'
 -newkey ec:file generate a new EC key, parameters taken from CA in 'file'
 -[digest]      Digest to sign with (md5, sha1, md2, mdc2, md4)
 -config file   request template file.
 -subj arg      set or modify request subject
 -multivalue-rdn enable support for multivalued RDNs
 -new           new request.
 -batch         do not ask anything during request generation
 -x509          output a x509 structure instead of a cert. req.
 -days          number of days a certificate generated by -x509 is valid for.
 -set_serial    serial number to use for a certificate generated by -x509.
 -newhdr        output "NEW" in the header lines
 -asn1-kludge   Output the 'request' in a format that is wrong but some CA's
                have been reported as requiring
 -extensions .. specify certificate extension section (override value in config file)
 -reqexts ..    specify request extension section (override value in config file)
 -utf8          input characters are UTF8 (default ASCII)
 -nameopt arg    - various certificate name options
 -reqopt arg    - various request text options
```

生成自签名证书需要用到下面几个选项：
>x509      生成自签名证书
nodes     跳过为证书设置密码的阶段，这样nginx可以直接打开证书
days      证书有效期，默认30天
newkey    生成证书请求或自签名证书时自动生成密钥，然后生成的密钥名称由keyout参数指定
keyout    指定生成私钥文件的文件名
out       指定生成的证书请求或者自签名证书名称
----

**生成自签名证书**

```text
docker@default:~/openssl$ openssl req \
> -x509 \
> -nodes \
> -days 30 \
> -newkey rsa:2048 \
> -keyout pureven.key \
> -out pureven.crt
Generating a 2048 bit RSA private key
......+++++
.....................................+++++
writing new private key to 'pureven.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:    
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
docker@default:~/openssl$ ls
pureven.crt  pureven.key
```

----

**查看证书内容**

查看证书信息用到的几个选项：
>in       指定证书请求文件，当查看证书请求内容或者生成自签名证书的时候使用
noout     输出到屏幕
text      用文本方式详细打印出该证书的所有细节
subject   打印出证书拥有者的名字
issuer    打印证书颁发者名字
modulus   打印出公共密钥的系数值


```text
docker@default:~/nginx/conf/certs$ openssl x509 -in pureven.crt -noout -text  -subject                                               
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            86:90:cb:ca:29:a4:3b:96
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=AU, ST=Some-State, O=Internet Widgits Pty Ltd
        Validity
            Not Before: Nov 13 12:48:23 2019 GMT
            Not After : Dec 13 12:48:23 2019 GMT
        Subject: C=AU, ST=Some-State, O=Internet Widgits Pty Ltd
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:da:20:76:24:4f:04:0a:9a:2d:6c:60:ca:38:fc:
                    4f:e4:a1:5c:fb:e4:4b:fd:74:1d:9d:ff:13:b1:4a:
                    3c:1d:1a:25:37:2a:23:b1:b9:be:6e:15:c4:38:6e:
                    43:ce:6d:5f:18:67:6e:ef:a1:b7:07:1f:17:17:81:
                    75:fa:c5:a0:09:65:dc:08:81:80:46:c9:a1:21:1a:
                    ed:19:c5:8d:b6:9c:89:40:30:ea:b3:5c:98:6f:6b:
                    74:29:ea:55:33:35:b6:28:7d:2a:4e:5f:7c:6e:44:
                    3c:99:fc:0b:f3:ee:7e:4f:a8:c3:1e:7b:dc:54:27:
                    f1:25:2d:7d:25:de:56:79:81:69:8c:a0:2b:45:9e:
                    de:f6:c6:4c:62:ba:4f:8c:f5:97:72:3c:2c:0b:bf:
                    4a:93:39:ac:b2:f0:30:e8:34:ef:99:60:a6:7e:f2:
                    e0:c5:18:1f:0b:75:be:59:d1:9c:47:70:ee:80:2b:
                    f6:bb:02:b9:73:89:49:b3:1e:58:10:fb:8e:9d:3f:
                    f9:8b:b8:d6:a1:b0:ec:42:94:e7:9f:f8:4f:12:70:
                    e7:f7:13:a4:a6:81:75:17:30:d9:e6:d4:2b:b3:cf:
                    ea:36:12:4b:2d:e1:6e:aa:55:81:18:62:41:71:de:
                    53:69:f6:7a:e7:1e:28:06:47:11:4a:2d:d2:b1:ab:
                    04:79
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                67:C4:2B:CA:B4:F6:D0:6E:1E:37:D8:23:D4:8F:82:A4:E8:7A:8D:80
            X509v3 Authority Key Identifier: 
                keyid:67:C4:2B:CA:B4:F6:D0:6E:1E:37:D8:23:D4:8F:82:A4:E8:7A:8D:80

            X509v3 Basic Constraints: 
                CA:TRUE
    Signature Algorithm: sha256WithRSAEncryption
         7d:da:a3:9a:ea:60:be:48:ca:c7:c6:5b:cf:ac:c9:4f:b9:4d:
         14:8a:93:fb:a8:59:8d:b7:e4:e6:fc:9a:97:66:8a:5b:25:5e:
         fc:70:ec:ed:03:0e:cd:df:1c:ef:1b:42:8f:93:ab:e1:2f:3a:
         f4:82:dc:ed:2d:45:d5:0d:2b:d3:cf:04:38:c3:58:e5:a8:28:
         a9:75:cc:f7:57:9b:94:67:56:5f:ae:c9:4b:7c:a8:a3:1c:cd:
         25:44:0a:ec:ef:ba:49:ec:e8:53:94:1c:38:71:5f:9e:e0:ed:
         b8:36:81:65:60:23:16:2d:7f:67:58:1f:89:f2:ba:a3:a0:1d:
         77:a9:91:6f:a8:11:c4:ac:a5:b0:62:84:01:bf:f9:f4:37:29:
         49:0f:62:b3:7f:d8:40:52:07:4c:70:3d:87:b6:e9:b4:d1:8d:
         4a:2b:b7:81:57:dc:13:78:4e:5c:51:b8:3d:9c:fd:51:07:50:
         38:25:07:ba:76:f0:27:b3:8b:8b:31:19:74:14:82:2c:70:ca:
         05:88:ae:7d:e9:4e:de:d5:54:de:8f:f2:ba:de:3a:1a:3a:fc:
         14:0a:80:f2:31:8d:42:6e:fb:d9:b8:ed:a9:84:34:8b:1c:91:
         03:3b:c7:38:f7:7a:0b:bc:c1:61:e2:fc:b5:98:5e:ef:d6:81:
         5d:ab:c1:81
subject= /C=AU/ST=Some-State/O=Internet Widgits Pty Ltd
```
