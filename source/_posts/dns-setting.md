---
title: 域名解析
date: 2019-12-01 12:32:04
tags:
- 网络
categories:
- web学习笔记
---

#### 引言 ####

在阿里云上注册了一个域名`pureven.cc`，选择`.cc`是因为感觉有个性吧。但是注册完成后紧跟着有几个问题：①如何将域名跟我的网站联系起来呢？②我的博客是放到github上面的，并给仓库取名`pureven.github.io`，如何将注册的域名跟我的博客仓库连接起来，实现当我访问`pureven.cc`的时候直接访问我的博客？

<!-- more -->

#### 什么时域名解析 ####

为了解决上述问题，这里引入域名解析的概念。`域名解析`**就是把域名指向网站所在服务器的IP，让人们通过注册的域名可以访问到网站**。IP地址是网络上标识服务器的数字地址，为了方便记忆，使用域名来代替IP地址。域名解析就是域名到IP地址的转换过程，域名的解析工作由DNS服务器完成。DNS服务器会把域名解析到一个IP地址，然后在此IP地址的主机上将一个子目录与域名绑定。域名解析时会添加解析记录，这些记录有：A记录、AAAA记录、CNAME记录、MX记录、NS记录、TXT记录、SRV记录、URL转发。

---

#### 添加记录各选项说明 ####

以阿里云域名解析记录类型为例，一条记录由`记录类型`、`主机记录`、`解析线路`、`记录值`和`TTL`组成，如图：
<img src="dns-setting/20191201145557.png" class="nofancybox" />

##### 记录类型 #####

记录类型有以下几种：

| 记录类型 | 介绍 |
| ---: | --: |
| A | 地址记录，用来指定域名的 IPv4 地址（例如 8.8.8.8），如果需要将域名指向一个 IP 地址（外网地址） |
| CNAME | 如果需要将域名指向另一个域名，再由另一个域名提供 IP 地址 |
| AAAA | 用来指定主机名（或域名）对应的 IPv6 地址（例如 ff06:0:0:0:0:0:0:c3）记录`注意：截止到11月25号，IPV4已经用完` |
| NS | 域名服务器记录，如果需要把子域名交给其他 DNS 服务商解析，比如用户希望由`12.34.56.78`这台服务器解析`blog.pureven.cc`，则需要设置`blog.pureven.cc`的NS记录，需要注意的是`NS的优先级比A/CNAME的高` |
| MX | 将域名指向邮件服务器地址，例如用户所用的邮件是以域名`pureven.com`为结尾的，则需要在管理界面中添加该域名的MX记录来处理所有以`@pureven.com`结尾的邮件 |
| SRV | 记录提供特定的服务的服务器 |
| TXT | 文本长度限制512，通常做SPF记录(反垃圾邮件) |
| CAA | CA证书颁发机构授权校验 |
| 显性URL | 将域名重定向到另外一个地址，比如将`www.pureven.cc`显性转发到`www.pureven.com`后，当访问`www.pureven.cc`时，地址栏显示的地址是`www.pureven.com` |
| 隐性URL | 与显性URL类似，但是会隐藏真实目标地址，比如将`www.pureven.cc`隐性转发到`www.pureven.com`后，当访问`www.pureven.cc`时，地址栏显示的是`www.pureven.cc`，实际访问的是`www.pureven.com` |


**说明：** A记录就是把一个域名解析到一个IP地址（Address，特制数字IP地址），而CNAME记录就是把域名解析到另外一个域名。其功能是差不多，CNAME将几个主机名指向一个别名，其实跟指向IP地址是一样的，因为这个别名也要做一个A记录的。但是使用CNAME记录可以很方便地变更IP地址。如果一台服务器有100个网站，他们都做了别名，该台服务器变更IP时，只需要变更别名的A记录就可以了。
 
---

##### 主机记录 #####

主机记录就是域名前缀，常见用法有：

| 主机记录 | 用法 |
| :--: | :--: |
| www | 解析后的域名为`www.pureven.com` |
| @ | 直接解析主域名 `pureven.com` |
| * | 泛解析，匹配其他所有域名 `*.pureven.com` |
| mail | 将域名解析为`mail.pureven.com`，通常用于解析邮箱服务器 |
| 二级域名 | 如：`abc.pureven.com`，填写abc |
| 手机网站 | 如：`m.pureven.com`，填写m |
| 显性URL | 不支持泛解析（泛解析：将所有子域名解析到同一地址）|

---

##### 解析线路 #####

不同套餐支持的解析线路，本域名使用的免费的版，因此支持**默认、境外、移动、电信、联通、教育网、百度、必应、谷歌**

下面时[腾讯](https://cloud.tencent.com/document/product/302/8643)的说明：
>例如，将 cloud.tencent.com 设置【默认】线路解析到8.8.8.8，【广东】线路解析到9.9.9.9，【广东电信】线路解析到10.10.10.10，则广东的电信运营商用户访问将返回10.10.10.10的 IP 地址，广东非电信运营商用户访问将返回9.9.9.9的 IP 地址，非广东地区用户访问将返回8.8.8.8的 IP 地址。
此时若暂停广东电信线路或广东线路的解析，全国地区的解析都不会受到影响，将全部返回8.8.8.8的 IP 地址。所以无论是否添加地区或者运营商的线路，一定需要先添加好【默认】线路的解析。
>
>搜索引擎线路使用说明
搜索引擎线路可以设置百度、谷歌等的蜘蛛抓取不同的 IP 地址。例如，将 cloud.tencent.com 设置【默认】线路解析到8.8.8.8；【百度】线路解析到9.9.9.9；【搜狗】线路解析到10.10.10.10，则用户通过搜狗搜索到站点进行访问，将返回10.10.10.10的 IP 地址；通过百度搜索访问，将返回9.9.9.9的 IP 地址；直接访问站点，将返回8.8.8.8的 IP 地址。


| 解析线路 | 说明 |
| -- | -- |
| 默认 | 若您未设置特定解析线路，则所有线路用户均访问该目标地址 |
| 联通 | 单独为用【联通线路】访问的用户指定目标地址，其他用户仍然访问默认的目标地址 |
| 电信 | 单独为用【电信线路】访问的用户指定目标地址，其他用户仍然访问默认的目标地址 |
| 移动 | 单独为用【移动线路】访问的用户指定目标地址，其他用户仍然访问默认的目标地址 |
| 境外 | 单独为用【境外线路】访问的用户指定目标地址，其他用户仍然访问默认的目标地址 |
| 教育网 | 单独为用【教育网线路】访问的用户指定目标地址，其他用户仍然访问默认的目标地址 |
| 搜索引擎 | 指定一个服务器IP让搜索引擎（谷歌、百度、必应等）蜘蛛抓取 |

---

##### 记录值 #####

**记录值**的设置跟记录类型有关，下面通过表格进行举例：

| 记录类型 | 记录值 |
| :--: | :--: |
| A | 8.8.8.8 |
| CNAME | `pureven.github.io` |
| AAAA | ff06:0:0:0:0:0:0:c3 |
| NS | `ns.pureven.cc` |
| MX | `mail.pureven.cc` |
| SRV | 1 0 9 `srv.pureven.cc` |
| TXT | 2018113000666039ccllnqjav9an2l2zu717m10ovdfp5n972hcj9gzeseklbmt1 |
| CAA | 假如只允许由 `symantec.com` 来颁发域名 `pureven.cc` 的证书，并且发送违规通知到邮箱 `admin@pureven.cc`，则需要设置为 `0 issue "symantec.com"` 和 `0 iodef "mailto:admin@pureven.cc"`|
| 显性URL | `www.pureven.com` |
| 隐性URL | `www.pureven.com` |

---

##### TTL #####

TTL是英语Time-To-Live的简称，意思为一条域名解析记录在DNS服务器中的存留时间。当各地的DNS服务器接受到解析请求时，就会向域名指定的NS服务器发出解析请求从而获得解析记录；在获得这个记录之后，记录会在DNS服务器中保存一段时间，这段时间内如果再接到这个域名的解析请求，DNS服务器将不再向NS服务器发出请求，而是直接返回刚才获得的记录；而这个记录在DNS服务器上保留的时间，就是TTL值。以阿里云为例，可以设置TTL的值为`10分钟`、`30分钟`、`1小时`、`12小时`、`1天`。

选择时根据需求有两种策略：
- 增大TTL值，减少域名解析时间。
一般情况下，域名解析的各个记录可能很长一段时间内都不会有变化。我们可以增大域名记录的TTL值让记录在各地DNS服务器中缓存的时间加长，这样在更长的一段时间内，我们访问这个网站时，本地ISP的DNS服务器就不需要向域名的DNS服务器发出解析请求，而直接从缓存中返回域名解析记录。不过需要注意的是，如果TTL设置的值过大，当您的网站更换空间时，旧的记录要很久才会更新，有时会造成网站的重要变动不能及时更新。

- 减小TTL值，及时更新网络。
更换空间99.9%会有DNS记录更改的问题，因为缓存的问题，新的域名记录在有的地方可能生效了，但在有的地方可能等上一两天甚至更久才生效。结果就是有的人可能访问到了新服务器，有的人访问到了旧服务器。这时我们可以减TTL值，让DNS服务器中的缓存尽快刷新。减少TTL值的操作必须在主机调整/网络调整之前提前进行。这样才能保证在主机/网络调整完成后，能够在最小时间内实现更新。不过如果数值设置太小，会使DNS频繁刷新，有时会造成访问不稳定。

---

#### 添加记录举例 ####

下面是本站解析记录，仅供参考：
<table>
<tr>
<th style="text-align:center">name</th>
<th>value</th>
</tr>
<tr>
<td>记录类型</td>
<td>CNAME</td>
</tr>
<tr>
<td>主机记录</td>
<td>@</td>
</tr>
<tr>
<td>解析线路</td>
<td>默认</td>
</tr>
<tr>
<td>记录值</td>
<td>pureven.github.io</td>
</tr>
<tr>
<td>TTL</td>
<td>1天</td>
</tr>
</table>

